<!DOCTYPE html>
<html>

<head>

  <!-- Required meta tags -->
  <meta charset="utf-8">

  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
    integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
    integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
    crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
    integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
    crossorigin="anonymous"></script>
  <title>yolo image recognition</title>

 
</head>

<body>
  <div class="container">
    <div class="row">

      <div class="col-sm">
        <span class="border border-primary">
          <img src="{{ url_for('static', filename = user_image)}}" alt="User Image" width="500" height="600" class="img-thumbnail">
        </span>
      </div>

      <div class="col-sm">
        <h1 id="labels">found this</h1>
        {% for product in products %}
          <h2>{{product}}</h2>
        {% endfor %}
      </div>

      <p class="reviews">
        <table class="table">
            <thead>
            <tr>
                <th scope="col">식품</th>
                <th scope="col">열량(kcal)</th>
                <th scope="col">나트륨(mg)</th>
                <th scope="col">탄수화물(g)</th>
                <th scope="col">지방(g)</th>
                <th scope="col">콜레스테롤(mg)</th>
                <th scope="col">단백질(g)</th>    
            </tr>
            </thead>
            <tbody id="info_nutrition">
            </tbody>
        </table>
      </p>
    </div>
  </div>
  <script>
    $(document).ready(function () {
      showNutrition();
    });

    function showNutrition() {
      $.ajax({
        type: "GET",
        url: "./static/nutrition.json",
        data: {},
        success: function (response) {
          let nutrition = response['nutrition']
          let products = "{{products|safe}}"
          var reg = /[\{\}\[\]\/?.,;:|\)*~`!^\-_+<>@\#$%&\\\=\(\'\"]/gi
          products = products.replace(reg, "")
          products = products.split(" ")
          console.log(products)
          for (let product of products) {
            nutrition.filter(function (obj) {
            if (obj['name'] === product) {
              // console.log('있음');
              let name = nutrition[obj['id']]['name']
              let calories = nutrition[obj['id']]['calories']
              let sodium = nutrition[obj['id']]['sodium']
              let carbohydrate = nutrition[obj['id']]['carbohydrate']
              let fat = nutrition[obj['id']]['fat']
              let cholesterol	 = nutrition[obj['id']]['cholesterol']
              let protein	 = nutrition[obj['id']]['protein']

              let temp_html = `<tr>
                                  <td>${name}</td>
                                  <td>${calories}</td>
                                  <td>${sodium}</td>
                                  <td>${carbohydrate}</td>
                                  <td>${fat}</td>
                                  <td>${cholesterol}</td>
                                  <td>${protein}</td>                
                              </tr>`
              $('#info_nutrition').append(temp_html)
            }else{
              // console.log('없음');
            }
          });
          }
  //         for (let i = 0; i < product.length; i++) {
  //           let name = nutrition[i]['name']
  //           let calories = nutrition[i]['calories']
  //           let sodium = nutrition[i]['sodium']
  //           let carbohydrate = nutrition[i]['carbohydrate']
  //           let fat = nutrition[i]['fat']
  //           let cholesterol	 = nutrition[i]['cholesterol']
  //           let protein	 = nutrition[i]['protein']

  //           let temp_html = `<tr>
  //                               <td>${name}</td>
  //                               <td>${calories}</td>
  //                               <td>${sodium}</td>
  //                               <td>${carbohydrate}</td>
  //                               <td>${fat}</td>
  //                               <td>${cholesterol}</td>
  //                               <td>${protein}</td>                
  //                           </tr>`
  //           $('#info_nutrition').append(temp_html)
  //         }
        }
      })
   }
  </script>
</body>

</html>